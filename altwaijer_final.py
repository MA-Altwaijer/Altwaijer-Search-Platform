import streamlit as st
import pandas as pd
from pypdf import PdfReader
import re

st.set_page_config(page_title="Altwaijer Writing Master", layout="wide")
st.markdown("<h1 style='text-align:center; color: #1E3A8A;'>โ๏ธ ููุตุฉ M.A. Altwaijer ููุตูุงุบุฉ ุงูุฃูุงุฏูููุฉ ุงููุชูุฏูุฉ</h1>", unsafe_allow_html=True)

# 1. ูุงุฆูุฉ ุงุฎุชูุงุฑ ูุบูุฉ ุงููุชุงุจุฉ (Tone Selection)
st.sidebar.header("โ๏ธ ุฅุนุฏุงุฏุงุช ุงููุชุงุจุฉ")
writing_tone = st.sidebar.selectbox(
    "ุงุฎุชุฑ ูุบูุฉ ุงูุตูุงุบุฉ:",
    ["ููุฏูุฉ (ุฅุจุฑุงุฒ ุงููุฌูุงุช)", "ูุตููุฉ (ุนุฑุถ ูููุฌู)", "ููุงุฑูุฉ (ุฅุจุฑุงุฒ ุงูุชููุฒ)"]
)

def generate_synthesis(files, tone):
    count = len(files)
    if tone == "ููุฏูุฉ (ุฅุจุฑุงุฒ ุงููุฌูุงุช)":
        text = f"ุจุงูุฑุบู ูู ุชุนุฏุฏ ุงูุฏุฑุงุณุงุช ุงูุณุงุจูุฉ ุงูุชู ุจูุบุช ({count}) ุฏุฑุงุณุฉุ ุฅูุง ุฃู ุงููุฑุงุกุฉ ุงููุงุญุตุฉ ุชูุดู ุนู ูุตูุฑ ูุงุถุญ ูู ูุนุงูุฌุฉ ุงูุฌูุงูุจ ุงูุฅุฌุฑุงุฆูุฉุ ุญูุซ ุบูุจ ุนูููุง ุงูุทุงุจุน ุงููุธุฑู ุงููุตููุ ููุง ููุชุญ ุงููุฌุงู ุฃูุงู ุงูุฏุฑุงุณุฉ ุงูุญุงููุฉ ูุณุฏ ูุฐู ุงููุฌูุฉ."
    elif tone == "ูุตููุฉ (ุนุฑุถ ูููุฌู)":
        text = f"ุชุณุชุนุฑุถ ูุฐู ุงููุฑุงุฌุนุฉ ุงููููุฌูุฉ ูุนุฏุฏ ({count}) ูู ุงูุฃุจุญุงุซุ ุญูุซ ุชุจูู ุชููุนุงู ูู ุงูููุงูุฌ ุงููุณุชุฎุฏูุฉ ุจูู ุงููุตูู ูุงูุชุญููููุ ููุง ุณุงูู ูู ุจูุงุก ูุงุนุฏุฉ ูุนุฑููุฉ ุฑุตููุฉ ุญูู ุงูููุถูุน ุชุนุชูุฏ ุนูููุง ุงูุฏุฑุงุณุฉ ุงูุญุงููุฉ ูู ุชุฃุตูู ุฅุทุงุฑูุง ุงููุธุฑู."
    else: # ููุงุฑูุฉ
        text = f"ูู ุฎูุงู ุงูููุงุฑูุฉ ุงููููุฌูุฉ ูู ({count}) ุฏุฑุงุณุฉุ ูุชุถุญ ุฃู ุงูุฏุฑุงุณุฉ ุงูุญุงููุฉ ุชุชูุงุทุน ูุน ุณุงุจูุงุชูุง ูู ุงูุฃูุฏุงู ุงูุนุงูุฉุ ูููููุง ุชููุฑุฏ ุนููุง ุจุชูุฏูู ูููุฐุฌ ุชุทุจููู ูุชูุงูู ูุฌูุน ุจูู ุงูุงุณุชุฏูุงู ุงูุชุฌููุนู ูุงูุชูููุฐ ุงูููุฏุงูู."
    return text

uploaded_files = st.file_uploader("๐ ุงุฑูุนู ุงููุฑุงุฌุน (PDF):", type="pdf", accept_multiple_files=True)

if uploaded_files:
    if st.button("๐ ุชูููุฏ ุงููุต ุงูุฃูุงุฏููู ุงููุฎุตุต"):
        with st.spinner("ุฌุงุฑู ุชุญููู ุงูุฏุฑุงุณุงุช ูุตูุงุบุชูุง ุจุงููุบูุฉ ุงููุฎุชุงุฑุฉ..."):
            final_text = generate_synthesis(uploaded_files, writing_tone)
            
            # ุนุฑุถ ุงููุต ุงูุฌุงูุฒ ูููุณุฎ
            st.subheader(f"๐ ุงููุต ุงูุฃูุงุฏููู ุจูุบูุฉ: {writing_tone}")
            st.success("ูุฐุง ุงููุต ุฌุงูุฒ ูููุถุน ูู ูุตู ุงูุฏุฑุงุณุงุช ุงูุณุงุจูุฉ ูุจุงุดุฑุฉ:")
            st.text_area("ุงูุณุฎู ูู ููุง:", final_text, height=150)

            # ูุตูููุฉ ุงูุชูุซูู (ุงูุฃุฑุถูุฉ)
            st.subheader("๐ ูุตูููุฉ ุชูุซูู ุงููุฑุงุฌุน ุงููุฑููุนุฉ")
            summary_list = [{"ุงุณู ุงูุฏุฑุงุณุฉ": f.name, "ุงูุญุงูุฉ": "ุชู ุงูุชุญููู"} for f in uploaded_files]
            st.table(pd.DataFrame(summary_list))

            # ุฒุฑ ุงูุชุญููู
            st.download_button("๐ฅ ุชุญููู ุงููุต ุงููุตุงุบ", final_text, file_name="Academic_Writing.txt")

st.markdown("---")
st.caption("ุฅุดุฑุงู ูุชุทููุฑ: ุฏ. ูุจุฑููุฉ ุงูุชููุฌุฑ - 2026 | ุฎุจูุฑ ุงูุตูุงุบุฉ ุงูุฃูุงุฏูููุฉ")
