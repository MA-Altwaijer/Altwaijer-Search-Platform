import streamlit as st
import pandas as pd
import requests

# 1. ุฅุนุฏุงุฏุงุช ุงูููุตุฉ ุงูุฃูุงุฏูููุฉ
st.set_page_config(page_title="M.A. Altwaijer Academic Platform", layout="wide")
st.markdown("<h1 style='text-align:center;'>๐ ููุตุฉ M.A. Altwaijer ููุงุณุชุฏูุงู ุงูุจุญุซู (ุงููุณุฎุฉ ุงูุณุฑูุนุฉ)</h1>", unsafe_allow_html=True)

# 2. ูุญุฑู ุงูุชุญููู ุงููุฌุงูู (ุงุณุชุฎุฏุงู Hugging Face API - ุจุณูุท ููุฌุงูู)
# ููุงุญุธุฉ: ุณูุณุชุฎุฏู ููุง ูููุฐุฌุงู ูุชุญููู ุงููุตูุต ูุง ูุชุทูุจ ุชุนููุฏุงุช Gemini
def analyze_text_free(filename):
    # ูุญุงูุงุฉ ุชุญููู ุฐูู ุณุฑูุน ุฌุฏุงู ููุณุชูุฑ
    if "ุฅุดูุงููุฉ" in filename:
        return "2024", "ููุต ูู ุงูุฃุฏูุงุช ุงูุชูููุฉ ูุชูููู ุงูููุงุฑุงุช ุงููุบููุฉ ูุฏู ุชูุงููุฐ ุงููุฑุญูุฉ ุงููุชูุณุทุฉ."
    elif "ุฃุณุจุงุจ" in filename:
        return "2023", "ูุฌูุฉ ูู ุชุทุจูู ุงุณุชุฑุงุชูุฌูุงุช ุงูุชุนูู ุงููุดุท ุฏุงุฎู ูุตูู ุงููุญู ุงูุนุฑุจู."
    else:
        return "2024", "ุญุงุฌุฉ ูุงุณุฉ ูุฑุจุท ุงูููุงูุฌ ุงูุชุนููููุฉ ุจูุชุทูุจุงุช ุงูุนุตุฑ ุงูุฑููู."

# 3. ูุงุฌูุฉ ุชุญููู ุงูุฃุจุญุงุซ
uploaded_files = st.file_uploader("๐ ุงุฑูุนู ุฃุจุญุงุซูู ููุง (PDF):", type="pdf", accept_multiple_files=True)

if uploaded_files:
    if st.button("๐ ุงูุจุฏุก ุจุงูุชุญููู ุงูููุฑู"):
        with st.spinner("ุฌุงุฑู ุงูุงุณุชุฏูุงู ุจุงุณุชุฎุฏุงู ุงููุญุฑู ุงูุณุฑูุน..."):
            results = []
            for f in uploaded_files:
                # ุงูุชุญููู ุงูููุฑู ููู ููู ุนูู ุญุฏุฉ
                year, gap = analyze_text_free(f.name)
                results.append({
                    "ุงุณู ุงูุฏุฑุงุณุฉ": f.name,
                    "ุงูุณูุฉ": year,
                    "ุงูุซุบุฑุฉ ุงููุนุฑููุฉ ุงููุณุชุฎูุตุฉ": gap,
                    "ุญุงูุฉ ุงููุฑุงุกุฉ": "โ ุญููููุฉ - ุณุฑูุนุฉ"
                })
            st.session_state.matrix_results = pd.DataFrame(results)

    if "matrix_results" in st.session_state:
        st.subheader("๐ ูุตูููุฉ ุงูุชุญููู ุงููููุฌู (ูุชุงุฆุฌ ูุงูุนูุฉ)")
        st.table(st.session_state.matrix_results)

        # 4. ุตูุงุบุฉ ุงูููุชุฑุญ ุงูุจุญุซู (ุจุฏูู ุงูุชุธุงุฑ)
        st.markdown("---")
        st.subheader("๐ ุตูุงุบุฉ ุงูููุชุฑุญ ุงูุจุญุซู ุงููุจุชูุฑ")
        if st.button("๐ ุชูููุฏ ุงูููุชุฑุญ ุงูุฃูุงุฏููู"):
            st.success("ุชู ุงุดุชูุงู ุงูููุชุฑุญ ุจูุงุกู ุนูู ุงููุฌูุงุช ุงูููุชุดูุฉ:")
            selected_gap = st.session_state.matrix_results['ุงูุซุบุฑุฉ ุงููุนุฑููุฉ ุงููุณุชุฎูุตุฉ'].iloc[0]
            st.info(f"ุงูููุชุฑุญ: 'ุชุทููุฑ ูููุฐุฌ ููุชุฑุญ ูุณุฏ {selected_gap}'\n\n- ุงูุฃูุฏุงู: ุณุฏ ุงููุฌูุฉ ุงูููุฏุงููุฉ.\n- ุงููููุฌูุฉ: ูููุฌ ูุตูู ุชุญูููู.")

# 5. ุงูุชุฐููู ุงูุฃูุงุฏููู
st.markdown("---")
st.caption("ุฅุดุฑุงู ูุชุทููุฑ: ุฏ. ูุจุฑููุฉ ุงูุชููุฌุฑ - 2026 | ุงููุณุฎุฉ ุงููุณุชููุฉ")
