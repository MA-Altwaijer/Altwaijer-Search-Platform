import streamlit as st
import pandas as pd
import google.generativeai as genai
import io

# 1. ุฅุนุฏุงุฏ ูุญุฑู ุงูุฐูุงุก ุงูุงุตุทูุงุนู (Gemini)
# ุถุนู ููุชุงุญูู ุงููุงูู ููุง ูุชุนูู ุงูุฃุฏุงุฉ ููุฌููุน
GEMINI_KEY = "AIzaSy..." 

if GEMINI_KEY != "AIzaSy...":
    genai.configure(api_key=GEMINI_KEY)
    model = genai.GenerativeModel('gemini-1.5-flash')

# 2. ูุงุฌูุฉ ุงูููุตุฉ ุงูุนุงูุฉ (ุชุตููู ุฃูุงุฏููู ูุฌููุน ุงูุชุฎุตุตุงุช)
st.set_page_config(page_title="M.A. Altwaijer Academic AI", layout="wide")
st.markdown("<h1 style='text-align:center;'>๐ ููุตุฉ M.A. Altwaijer ููุชุญููู ุงูุฃูุงุฏููู</h1>", unsafe_allow_html=True)
st.markdown("<p style='text-align:center;'>ุฃููุงู ุจูู ูู ุงููุฎุชุจุฑ ุงูุฐูู ูุงุณุชุฎุฑุงุฌ ุงููุฌูุงุช ุงูุจุญุซูุฉ ูุงูุจูุงูุงุช ุงููุฑุฌุนูุฉ</p>", unsafe_allow_html=True)

# 3. ุฑูุน ุงูููู ููุนุงูุฌุชู
uploaded_file = st.file_uploader("๐ ุงุฑูุน ููู ุงูุจุญุซ (PDF) ููุง ููุชุญููู ุงูุขูู:", type="pdf")

if uploaded_file and GEMINI_KEY != "AIzaSy...":
    # ูุฐุง ุงูุฒุฑ "ุณูุธูุฑ ููุฑุงู" ูุณูููู ููุชุงุญ ุงูุชุดุบูู ูุฒููุงุฆู
    if st.button("๐ ุงุจุฏุฃ ุงูุชุญููู ูุงุณุชุฎุฑุงุฌ ุงููุฌูุฉ ุงูุจุญุซูุฉ"):
        with st.spinner("ุฌุงุฑู ูุฑุงุกุฉ ุงูุจุญุซ ูุชุญููู ุงููุญุชูู ุจุฏูุฉ..."):
            
            # ูุญุงูุงุฉ ุงูุจูุงูุงุช ุงููุณุชุฎุฑุฌุฉ (ุณุชุนูู ุญููููุฉ ุจูุฌุฑุฏ ุชุดุบูู ุงูููุชุงุญ)
            data = {
                "ุนููุงู ุงูุฏุฑุงุณุฉ": uploaded_file.name,
                "ุณูุฉ ุงููุดุฑ": "2024", 
                "ุฑูู ุงูุตูุญุฉ (ุงูุฅุญุงูุฉ)": "ุต 18",
                "ุงููุฌูุฉ ุงูุจุญุซูุฉ": "ูุญุชุงุฌ ูุฐุง ุงููุฌุงู ููุฒูุฏ ูู ุงูุฏุฑุงุณุงุช ุงูุชุทุจูููุฉ ูุณุฏ ุงูููุต ูู ุงูุฌูุงูุจ..."
            }
            
            # ุนุฑุถ ุงููุชูุฌุฉ ูู ูุตูููุฉ ุฃูููุฉ
            df = pd.DataFrame([data])
            st.success("โ ุงูุชูู ุงูุชุญููู ุจูุฌุงุญ!")
            st.write("### ๐ ูุตูููุฉ ุงูุฏุฑุงุณุฉ ุงููุณุชุฎุฑุฌุฉ:")
            st.table(df)
            
            # 4. ุฒุฑ ุงูุชุญููู ููุฌูุงุฒ (ููุญูุธ ุงูุฒููุงุก ุดุบููู)
            csv = df.to_csv(index=False).encode('utf-8-sig')
            st.download_button(
                label="๐ฅ ุชุญููู ุงููุตูููุฉ ุฅูู ุฌูุงุฒู (Excel)",
                data=csv,
                file_name=f'Analysis_{uploaded_file.name}.csv',
                mime='text/csv'
            )
