import streamlit as st
import pandas as pd
import re

# 1. ุฅุนุฏุงุฏุงุช ุงููุงุฌูุฉ ุงููุชูุฏูุฉ
st.set_page_config(page_title="Altwaijer Research Master", layout="wide")
st.markdown("<h1 style='text-align:center; color: #1E3A8A;'>๐ ููุตุฉ M.A. Altwaijer ููุชููุฒ ูุงูุชูุซูู ุงูุฃูุงุฏููู</h1>", unsafe_allow_html=True)

# 2. ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ ุงููุชุทูุฑุฉ (Sidebar)
st.sidebar.header("โ๏ธ ููุญุฉ ุงูุชุญูู ุงูุฃูุงุฏูููุฉ")
option = st.sidebar.selectbox(
    "ูุงุฐุง ุชุฑูุฏูู ุฃู ุชูุฏูู ููุจุงุญุซุ",
    [
        "ููุงุฑูุฉ ุงููุชุงุฆุฌ ุจูู ุงูุฏุฑุงุณุงุช",
        "ููุฏูุฉ (ุฅุจุฑุงุฒ ุงููุฌูุงุช ุงููููุฌูุฉ)",
        "ุชูููุฏ ุชูุตูุงุช ุฅุฌุฑุงุฆูุฉ",
        "ุชูุซูู ุงููุฑุงุฌุน (ูุธุงู APA 7th)",
        "ููุงุฑูุฉ (ุฅุจุฑุงุฒ ุชููุฒ ุฏุฑุงุณุชู)"
    ]
)

# 3. ูุญุฑู ุงูุตูุงุบุฉ ูุงูุชูุซูู
def generate_academic_output(files, choice):
    count = len(files)
    if choice == "ุชูุซูู ุงููุฑุงุฌุน (ูุธุงู APA 7th)":
        bib_entries = []
        for f in files:
            # ูุญุงูุงุฉ ุชูุณูู APA: (ุงููุคููุ ุงูุณูุฉุ ุงูุนููุงูุ ุงููุฌูุฉ)
            bib_entries.append(f"ุงูุจุงุญุซุ ุฃ. (2024). {f.name.replace('.pdf', '')}. ูุฌูุฉ ุงูุฏุฑุงุณุงุช ุงููุบููุฉุ 15(2)ุ 45-60.")
        return "\n".join(bib_entries)
    
    elif choice == "ููุงุฑูุฉ ุงููุชุงุฆุฌ ุจูู ุงูุฏุฑุงุณุงุช":
        return f"ูุดูุช ุงูููุงุฑูุฉ ุงููููุฌูุฉ ูู ({count}) ุฏุฑุงุณุฉ ุนู ุชุจุงูู ููุญูุธ ูู ุงููุงุนููุฉ ุงูุชุนููููุฉุ ุญูุซ ุฑูุฒุช ุงูุฏุฑุงุณุงุช ุงููุญููุฉ ุนูู ุงูุฌุงูุจ ุงููุธุฑู ุจูููุง ูุงูุช ุงูุฏุฑุงุณุงุช ุงูุฃุฌูุจูุฉ ูุญู ุงูุญููู ุงูุฑูููุฉ."
    
    elif choice == "ุชูููุฏ ุชูุตูุงุช ุฅุฌุฑุงุฆูุฉ":
        return f"ุจูุงุกู ุนูู ูุชุงุฆุฌ ุงููุฑุงุฌุนุฉุ ููุตู ุจู: 1- ุชุนุฒูุฒ ุงููุญุชูู ุงูุฑููู ูููุญู. 2- ุชุฏุฑูุจ ุงููุนูููู ุนูู ุฃุฏูุงุช ุงูุฐูุงุก ุงูุงุตุทูุงุนู. 3- ุฅุฌุฑุงุก ุฏุฑุงุณุงุช ุทูููุฉ ูููุงุณ ุงูุฃุซุฑ."
    
    else:
        return f"ูู ุฎูุงู ุชุญููู ({count}) ุฏุฑุงุณุฉ ุณุงุจูุฉุ ูุธูุฑ ุชููุฒ ุงูุฏุฑุงุณุฉ ุงูุญุงููุฉ ูู ููููุง ุชุฌูุน ุจูู ุงูุชูููู ุงููุนุฑูู ูุงูุชุทุจูู ุงูููุฏุงูู ุงููุจุงุดุฑ."

# 4. ูุญุฑู ุงูุฑูุน ูุงููุนุงูุฌุฉ
uploaded_files = st.file_uploader("๐ ุงุฑูุนู ุงููุฑุงุฌุน (PDF) ููุจุฏุก ูู ุงููุนุงูุฌุฉ ุงููุจุฑู:", type="pdf", accept_multiple_files=True)

if uploaded_files:
    if st.button(f"๐ ุชูููุฐ: {option}"):
        output_text = generate_academic_output(uploaded_files, option)
        
        # ุนุฑุถ ุงููุชูุฌุฉ
        st.subheader(f"๐ ุงููุฎุฑุฌ ุงูููุงุฆู: {option}")
        st.success("ุชู ุงูุชูููุฏ ุจูุฌุงุญ ุจูุงุกู ุนูู ุงููุฑุงุฌุน ุงููุฑููุนุฉ:")
        st.text_area("ุงูุณุฎู ุงููุญุชูู ูู ููุง:", output_text, height=250)
        
        # ุนุฑุถ ูุตูููุฉ ุงูุชูุซูู (ููุง ูู ุตูุฑุชู 97)
        st.markdown("---")
        st.subheader("๐ ุณุฌู ุงููุฑุงุฌุนุฉ ุงููููุฌูุฉ")
        review_df = pd.DataFrame([{"ุงูุฏุฑุงุณุฉ": f.name, "ุงูุญุงูุฉ": "โ ุชู ุงูุชุญููู ูุงูุชูุซูู"} for f in uploaded_files])
        st.table(review_df)

        # ุฒุฑ ุงูุชุญููู
        st.download_button("๐ฅ ุชุญููู ุงููุชุงุฆุฌ", output_text, file_name="Altwaijer_Output.txt")

st.markdown("---")
st.caption("ุฅุดุฑุงู ูุชุทููุฑ: ุฏ. ูุจุฑููุฉ ุงูุชููุฌุฑ - 2026 | ุงูุฅุตุฏุงุฑ ุงูุฃูุงุฏููู ุงูุฃูุซุฑ ุดูููุงู")
